<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game</title>

<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
html, body {
    margin:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
    font-family:'Poppins', sans-serif;
    touch-action:none;
    user-select:none;
}

#gameArea {
    position:fixed;
    inset:0;
    overflow:hidden;
}

/* ===== BACKGROUND RECTANGLES ===== */
#sky {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:50%;
    background:#4DA6FF;
    z-index:0;
}

#grass {
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    height:50%;
    background:#33CC33;
    z-index:0;
}

/* GOAL */
#goal {
    width:65%;
    max-width:340px;
    height:110px;
    border:10px solid #EEE;
    border-bottom:none;
    position:absolute;
    top:28%;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0, 0, 0, 0.271);
    z-index:4;
    border-radius:5px 5px 0 0;
}

/* GOALKEEPER */
#goalkeeper {
    width:50px;
    height:50px;
    background:#D32F2F;
    position:absolute;
    top:50%;
    left:50%;
    transform:translateX(-50%);
    border-radius:50%;
    border:2px solid white;
    z-index:5;
}

/* BALL */
#ball {
    width:58px;
    height:58px;
    border-radius:50%;
    position:absolute;
    bottom:0%;
    left:50%;
    transform:translate(-50%,0);
    background:url('https://upload.wikimedia.org/wikipedia/commons/d/d3/Soccerball.svg') center / 105% no-repeat;
    z-index:10;
}

/* MESSAGE */
#msgText {
    position:absolute;
    top:10%;
    left:50%;
    transform:translateX(-50%);
    font-size:50px;
    font-family:'Russo One', sans-serif;
    color:white;
    text-shadow:2px 2px 10px black;
    z-index:20;
    opacity:0;
    transition:0.3s;
}

/* SCORE */
#scoreDisplay {
    position:absolute;
    top:10px;
    right:20px;
    font-size:30px;
    color:white;
    font-family:'Russo One', sans-serif;
    z-index:21;
}

/* HAMBURGER MENU */
#hamburger {
    position:absolute;
    top:10px;
    left:20px;
    width:30px;
    height:25px;
    z-index:21;
    cursor:pointer;
}
#hamburger div {
    width:100%;
    height:4px;
    background:white;
    margin:4px 0;
}

/* POPUP & OVERLAY */
#overlay {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:none;
    z-index:30;
    display: flex;
    align-items: center;
    justify-content: center;
}


#popup {
    width:220px;
    max-width:90%;
    padding:20px;
    background:#fff;
    border-radius:15px;
    box-shadow:0 8px 25px rgba(0,0,0,0.25);
    z-index:31;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    text-align:center;
}

/* Popup Text */
#popup h3 {

    font-size:20px;
    font-weight:bold;
    color:#222;
}
#closePopup {
 
    border:none;

    background:#4caf4f00;
    color:rgb(0, 0, 0);
    font-weight:bold;
    cursor:pointer;
    width:100%;
 
    margin-left: 90%;
}
/* Popup Buttons */
#popup button:not(#closePopup) {
    padding:10px 15px;
    border:none;
    border-radius:10px;
    background:#4caf50;
    color:white;
    font-weight:bold;
    cursor:pointer;
    width:100%;
}

#popup button#returnHome {
    background:#000;
    margin-top:5px;
}

#popup button#skipCelebration {
    background:#4caf50;
    margin-top:5px;
}

/* ===== HITBOX DEBUG ===== */
.debug-hitbox {
    position:absolute;
    border:2px solid lime;
    pointer-events:none;
    z-index:9;
}

#goalHitbox {
    background:rgba(0,255,0,0.15);
}

/* TABLET & UP */
@media (max-width:768px) {
    #goal {
        width:75%;
        max-width:520px;
        height: 25%;
        border-width:14px;
    }
    #goalkeeper {
        width:80px;
        height:80px;
    }
}

/* 769-1440px smaller goal width */
@media (min-width:769px) and (max-width:1440px) {
    #goal {
        width:40%;
        max-width:400px;
        height: 25%;
    }
    #goalkeeper {
        width:80px;
        height:80px;
    }
}

/* -------- LARGE SCREENS -------- */
@media (min-width:1441px) {
    #goal {
        width:50%;
        max-width:700px;
    }
    #goalkeeper {
        width:90px;
        height:90px;
    }
}
@media (min-width:1442px) and (max-width:2560px) {
    #goal {
        width:70%;
        max-width:900px;
        height: 25%;
        top:40%;
    }
    #goalkeeper {
        width:80px;
        height:80px;
        top:65%;
    }
}
@media (min-width:2561px) {
    #goal {
        width:70%;
        max-width:900px;
        height: 25%;
        top:40%;
    }
    #goalkeeper {
        width:80px;
        height:80px;
        top:65%;
    }
}
/* ===== LAPTOP & DESKTOP UI SCALING ===== */
@media (min-width: 1024px) {

/* SCORE TEXT */
#scoreDisplay {
    font-size: 42px;
    top: 20px;
    right: 30px;
}

/* GOAL / MISS TEXT */
#msgText {
    font-size: 80px;
    top: 12%;
}

/* HAMBURGER MENU */
#hamburger {
    width: 45px;
    height: 38px;
    top: 20px;
    left: 30px;
}

#hamburger div {
    height: 6px;
    margin: 6px 0;
}

/* POPUP MENU */
#popup {
    width: 340px;
    padding: 30px;
    gap: 16px;
}

#popup h3 {
    font-size: 28px;
}

#popup button:not(#closePopup) {
    font-size: 18px;
    padding: 14px 18px;
}

#closePopup {
    font-size: 22px;
}
}
/* FADE IN FROM BLACK */
#fadeScreen {
    position:fixed;
    inset:0;
    background:black;
    z-index:50;
    opacity:1;
    transition: opacity 1.5s ease-out;
}

/* CROWD BEHIND GOAL */
#crowd {
    position:absolute;
    left:0;
    width:100%;
    height:100px;
    background:rgb(224, 184, 104); /* placeholder color for crowd */
    bottom:50%; /* just above grass */
    z-index:3;
    transform-origin: bottom center;
}

/* CROWD BOUNCE ANIMATION */
@keyframes bounceCrowd {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(-8px); }
    50% { transform: translateY(-16px); }
    75% { transform: translateY(-8px); }
}
.bounce {
    animation: bounceCrowd 0.6s ease;
}
</style>
</head>

<body>

<div id="gameArea">
    <div id="sky"></div>
    <div id="grass"></div>
<!-- FADE IN OVERLAY -->
<div id="fadeScreen"></div>

<!-- CROWD RECTANGLE -->
<div id="crowd"></div>
    <div id="goal"></div>
    <div id="goalkeeper"></div>
    <div id="ball"></div>

    <!-- SCORE -->
    <div id="scoreDisplay">Score: 0</div>

    <!-- HAMBURGER -->
    <div id="hamburger">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- POPUP OVERLAY -->
    <div id="overlay">
        <div id="popup">
            <!-- Close X button -->
            <button id="closePopup">✕</button>
            <h3>Pause Menu</h3>
            <button id="returnHome">Return Home</button>
            <button id="skipCelebration">Go to Celebration</button>
        </div>
    </div>

    <!-- HITBOX DEBUG -->
    <div id="ballHitbox" class="debug-hitbox"></div>
    <div id="keeperHitbox" class="debug-hitbox"></div>
    <div id="goalHitbox" class="debug-hitbox"></div>

    <div id="msgText"></div>
</div>

<script>
    // ===== ELEMENTS =====
    const ball = document.getElementById('ball');
    const keeper = document.getElementById('goalkeeper');
    const goal = document.getElementById('goal');
    const msgText = document.getElementById('msgText');
    const scoreDisplay = document.getElementById('scoreDisplay');

    const ballHitbox = document.getElementById('ballHitbox');
    const keeperHitbox = document.getElementById('keeperHitbox');
    const goalHitbox = document.getElementById('goalHitbox');

    const overlay = document.getElementById('overlay');
    const hamburger = document.getElementById('hamburger');
    const closePopupBtn = document.getElementById('closePopup');
    const returnHomeBtn = document.getElementById('returnHome');
    const skipCelebrationBtn = document.getElementById('skipCelebration');

    // ===== GAME STATE =====
    let ballX = 50, ballY = 15;
    let ballSpeedX = 0, ballSpeedY = 0;
    let isShooting = false;
    let isPaused = false;
    let isCooldown = false; // ✅ NEW
    let keeperX = 50;
    let keeperDir = 1;
    let keeperSpeedPx = 140;
    let score = 0;
    let lastTime = performance.now();
    const KEEPER_SPEED_MULTIPLIER_PER_SCORE = 0.05; // 5% faster per goal
    const GOAL_HITBOX_SCALE = 0.7;

    function resetBall() {
        ballX = 50; ballY = 0;
        ballSpeedX = 0; ballSpeedY = 0;
        isShooting = false;
        ball.style.left = ballX + '%';
        ball.style.bottom = ballY + '%';
        ball.style.transform = "translate(-50%,0) scale(1)";
    }

    function showMessage(text, color, callback) {
    isPaused = true;

    // Clear any existing message timer
    if (messageTimeoutId) {
        clearTimeout(messageTimeoutId);
        messageTimeoutId = null;
    }

    msgText.textContent = text;
    msgText.style.color = color;
    msgText.style.opacity = 1;

    messageTimeoutId = setTimeout(() => {
        msgText.style.opacity = 0;
        messageTimeoutId = null;

       
        if (!isMenuOpen) {
            isPaused = false;
        }

        if (callback) callback();
    }, 1900);
}

    function moveBall() {
        if (!isShooting || isPaused || isCooldown) return;

        ballX += ballSpeedX;
        ballY += ballSpeedY;
        ball.style.left = ballX + '%';
        ball.style.bottom = ballY + '%';

        const screenFactor = Math.min(window.innerWidth / 425, 1);
        let scale = (1 - ballY / 1000) * screenFactor;
        if (scale < 0) scale = 0;

        ball.style.transform =
            `translate(-50%,0) scale(${scale}) rotate(${ballY * 5}deg)`;

        checkCollision();
    }

    function moveKeeper(delta) {
        if (isPaused || isCooldown) return;

        const goalRect = goal.getBoundingClientRect();
        const speedMultiplier = 1 + score * KEEPER_SPEED_MULTIPLIER_PER_SCORE;
        const pxMove = keeperSpeedPx * speedMultiplier * delta;
         const percentMove = (pxMove / goalRect.width) * 100;

        keeperX += keeperDir * percentMove;

        if (keeperX > 75) { keeperX = 75; keeperDir = -1; }
        else if (keeperX < 25) { keeperX = 25; keeperDir = 1; }

        keeper.style.left = keeperX + '%';
    }

    function ballInsideGoalHitbox(ballRect, hitboxRect) {
        return (
            ballRect.right > hitboxRect.left &&
            ballRect.left < hitboxRect.right &&
            ballRect.bottom > hitboxRect.top &&
            ballRect.top < hitboxRect.bottom
        );
    }

    function checkCollision() {
        const b = ball.getBoundingClientRect();
        const k = keeper.getBoundingClientRect();
        const goalHB = goalHitbox.getBoundingClientRect();

        if (
            b.left < k.right &&
            b.right > k.left &&
            b.top < k.bottom &&
            b.bottom > k.top
        ) {
            showMessage("FAIL!", "#ff3333", resetBall);
            return;
        }

        if (ballInsideGoalHitbox(b, goalHB)) {
            score++;
            keeperSpeedPx += 10;
            scoreDisplay.textContent = "Score: " + score;
            showMessage("GOAL!", "#33ff33", resetBall);
            return;
        }

        if (ballY > 100) {
            showMessage("MISS!", "#ff3333", resetBall);
        }
    }

    function updateHitboxes() {
        const b = ball.getBoundingClientRect();
        const k = keeper.getBoundingClientRect();
        const g = goal.getBoundingClientRect();

        ballHitbox.style.left = b.left + 'px';
        ballHitbox.style.top = b.top + 'px';
        ballHitbox.style.width = b.width + 'px';
        ballHitbox.style.height = b.height + 'px';

        keeperHitbox.style.left = k.left + 'px';
        keeperHitbox.style.top = k.top + 'px';
        keeperHitbox.style.width = k.width + 'px';
        keeperHitbox.style.height = k.height + 'px';

        const hitboxWidth = g.width * GOAL_HITBOX_SCALE;
        const hitboxLeft = g.left + (g.width - hitboxWidth) / 2;

        goalHitbox.style.left = hitboxLeft + 'px';
        goalHitbox.style.top = g.top + 'px';
        goalHitbox.style.width = hitboxWidth + 'px';
        goalHitbox.style.height = (g.height * 0.5) + 'px';
    }

    function gameLoop(time) {
        const delta = (time - lastTime) / 1000;
        lastTime = time;

        moveKeeper(delta);
        moveBall();
        updateHitboxes();

        requestAnimationFrame(gameLoop);
    }
    requestAnimationFrame(gameLoop);

    document.body.addEventListener('click', e => {
        if (isShooting || isPaused || isCooldown) return;

        const goalRect = goal.getBoundingClientRect();
        let clampedX = Math.max(goalRect.left, Math.min(e.clientX, goalRect.right));
        let aim = (clampedX - goalRect.left) / goalRect.width;
        let direction = (aim - 0.5) * 2;

        ballSpeedX = direction * 1.8;
        ballSpeedY = 2.2;
        isShooting = true;
    });

    overlay.style.display = 'none';
    let messageTimeoutId = null;
    let isMenuOpen = false;
    // ===== PAUSE MENU =====
    hamburger.addEventListener('click', () => {
    overlay.style.display = 'flex';
    isMenuOpen = true;
    isPaused = true;
});

closePopupBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    isMenuOpen = false;

    isPaused = true;
    setTimeout(() => {
        isPaused = false;
    }, 100);
    if (messageTimeoutId) {
        clearTimeout(messageTimeoutId);
        messageTimeoutId = null;
    }
});

    returnHomeBtn.addEventListener('click', () => {
        window.location.href = "index2.html";
    });

    skipCelebrationBtn.addEventListener('click', () => {
        window.location.href = "end.html";
    });
    // FADE IN ON GAME START
window.addEventListener('load', () => {
    const fade = document.getElementById('fadeScreen');
    setTimeout(() => {
        fade.style.opacity = 0;
    }, 100); // tiny delay to ensure transition works
    setTimeout(() => {
        fade.style.display = 'none';
    }, 1600); // remove element after fade
});

// CROWD BOUNCE ON GOAL OR MISS
function animateCrowd() {
    const crowd = document.getElementById('crowd');
    crowd.classList.remove('bounce'); // reset
    void crowd.offsetWidth; // trigger reflow
    crowd.classList.add('bounce');
}

// CALL THIS WHEN GOAL OR MISS
function showMessage(text, color, callback) {
    isPaused = true;

    if (messageTimeoutId) {
        clearTimeout(messageTimeoutId);
        messageTimeoutId = null;
    }

    msgText.textContent = text;
    msgText.style.color = color;
    msgText.style.opacity = 1;

    // CROWD ANIMATION
    animateCrowd();

    messageTimeoutId = setTimeout(() => {
        msgText.style.opacity = 0;
        messageTimeoutId = null;

        if (!isMenuOpen) {
            isPaused = false;
        }

        if (callback) callback();
    }, 1900);
}
</script>

</body>
</html>